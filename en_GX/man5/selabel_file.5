.\" Yo Emacs muthafucka! This file is -*- nroff -*- source.
.\"
.\" Author: Eamon Walsh (ewalsh@tycho.nsa.gov) 2007
.TH "selabel_file" "5" "01 Dec 2011" "Securitizzle Enhanced Linux" "SELinux API documentation"
.SH "NAME"
selabel_file \- userspace SELinux labelin intercourse n' configuration file format fo' tha file contexts backend
.
.SH "SYNOPSIS"
.B #include <selinux/label.h>
.sp
.BI "int selabel_lookup(struct selabel_handle *" hnd ,
.in +\w'int selabel_lookup('u
.BI "security_context_t *" context ,
.br
.BI "const char *" path ", int " mode ");"
.in
.sp
.BI "int selabel_lookup_raw(struct selabel_handle *" hnd ,
.in +\w'int selabel_lookup('u
.BI "security_context_t *" context ,
.br
.BI "const char *" path ", int " mode ");"
.
.SH "DESCRIPTION"
Da file contexts backend maps from pathname/mode combinations tha fuck into securitizzle contexts, n' you can put dat on yo' toast. Well shiiiit, it is used ta find tha appropriate context fo' each file when relabelin a gangbangin' file system. Da returned \fIcontext\fR must be freed rockin \fBfreecon\fR(3).
.br
\fBselabel_lookup\fR(3) raps bout tha function wit its return n' error codes, however tha followin \fIerrno\fR is clarified further fo' tha file contexts backend:
.RS
.TP
.B ENOENT
No context correspondin ta tha \fIpath\fR n' \fImode\fR was found - This will also be returned when tha file contexts seriez of filez gotz a cold-ass lil context of \fB<<none>>\fR against tha \fIpath\fR (see tha \fBFILE FORMAT\fR section).
.RE
.sp
Da \fIpath\fR argument should be set ta tha full pathname of tha file whose assigned context is bein checked. Y'all KNOW dat shit, muthafucka! Da \fImode\fR argument should be set ta tha mode bitz of tha file, as determined by \fBlstat\fR(2). \fImode\fR may be zero, however full matchin may not occur.
.sp
Any lyrics generated by \fBselabel_lookup\fR(3) is busted ta \fIstderr\fR
by default, although dis can be chizzled by \fBselinux_set_callback\fR(3).
.sp
.BR selabel_lookup_raw (3)
behaves identically ta \fBselabel_lookup\fR(3) but do not big-ass up context
translation.
.sp
Da \fBFILES\fR section details tha configuration filez used ta determine a gangbangin' file context.
.
.SH "OPTIONS"
In addizzle ta tha global options busted lyrics bout up in 
.BR selabel_open (3),
this backend recognizes tha followin options:
.RS
.TP
.B SELABEL_OPT_PATH
A non-null value fo' dis option specifies a path ta a gangbangin' file dat is ghon be opened up in lieu of tha standard file contexts file.  This value be also used as tha base name fo' determinin tha namez of local customization files.
.TP
.B SELABEL_OPT_BASEONLY
A non-null value fo' dis option indicates dat any local customizations ta tha file contexts mappin should be ignored.
.TP
.B SELABEL_OPT_SUBSET
A non-null value fo' dis option is interpreted as a path prefix, fo' example "/etc".  Only file context justifications startin wit tha given prefix is loaded. Y'all KNOW dat shit, muthafucka!  This may increase lookup performance, however any attempt ta look up a path not startin wit tha given prefix will fail.
.RE
.
.SH "FILES"
Da file context filez used ta retrieve tha default context dependz on tha \fBSELABEL_OPT_PATH\fR parameta passed ta \fBselabel_open\fR(3). If \fINULL\fR, then tha \fBSELABEL_OPT_PATH\fR value will default ta tha actizzle policy file contexts location (as returned by \fBselinux_file_context_path\fR(3)), otherwise tha actual \fBSELABEL_OPT_PATH\fR value specified is used.
.sp
If \fBSELABEL_OPT_BASEONLY\fR is set, then tha followin filez is ghon be processed:
.RS
.IP "1." 4
Da mandatory file contexts file dat is either tha straight-up qualified file name from \fISELABEL_OPT_PATH.value\fR or if \fINULL\fR, then tha path returned by \fBselinux_file_context_path\fR(3).
.IP "2." 4
Da optionizzle local n' distribution substitution filez dat big-ass up path aliasin on tha 'in memory' version of tha file contexts file.
.br
These filez have tha same name as tha mandatory file contexts file wit tha extensions \fI.subs\fR n' \fI.subs_dist\fR added.
.RE
.sp
If tha \fBSELABEL_OPT_BASEONLY\fR aint set, then tha followin filez is ghon be processed:
.RS
.IP "1." 4
Da mandatory file contexts file dat is either tha straight-up qualified file name from \fISELABEL_OPT_PATH.value\fR or if \fINULL\fR, then tha path returned by \fBselinux_file_context_path\fR(3).
.IP "2." 4
Da optionizzle local customizations file dat has tha same ol' dirty name as tha mandatory file contexts file wit tha extension \fI.local\fR added.
.br
\fBselinux_file_context_local_path\fR(3) will return tha default path ta dis file.
.IP "3." 4
Da optionizzle user home directory customizations file dat has tha same ol' dirty name as tha mandatory file contexts file wit tha extension \fI.homedirs\fR added.
.br
\fBselinux_file_context_homedir_path\fR(3) will return tha default path ta dis file.
.IP "4." 4
Da optionizzle local n' distribution substitution filez dat big-ass up any path aliasin on tha 'in memory' version of tha file contexts file (and tha \fI.local\fR and/or \fI.homedirs\fR if present). These filez have tha same name as tha mandatory file contexts file wit tha extensions \fI.subs\fR n' \fI.subs_dist\fR added.
.br
\fBselinux_file_context_subs_path\fR(3) n' \fBselinux_file_context_subs_dist_path\fR(3) will return tha default paths ta these files.
.RE
.sp
Da default file context seriez of filez are:
.RS
.I /etc/selinux/{SELINUXTYPE}/contexts/files/file_contexts
.br
.I  /etc/selinux/{SELINUXTYPE}/contexts/files/file_contexts.local
.br
.I  /etc/selinux/{SELINUXTYPE}/contexts/files/file_contexts.homedirs
.br
.I  /etc/selinux/{SELINUXTYPE}/contexts/files/file_contexts.subs
.br
.I  /etc/selinux/{SELINUXTYPE}/contexts/files/file_contexts.subs_dist
.RE
.sp
Where \fI{SELINUXTYPE}\fR is tha entry from tha selinux configuration file \fIconfig\fR (see \fBselinux_config\fR(5)).
.sp
Only tha \fIfile_contexts\fR file is mandatory, tha remainder is optional.
.sp
Da entries within tha file contexts seriez of filez is shown up in tha \fBFILE FORMAT\fR section.
.
.SH "FILE FORMAT"
.sp
.SH "File Contexts Format"
.sp
Each line within tha \fIfile_contexts\fR n' tha two customization filez (\fI.local\fR n' \fI.homedirs\fR) be as bigs up:
.sp
.RS
.I pathname [file_type] context
.RE
.sp
Where:
.br
.RS
.I pathname
.RS
An entry dat defines tha pathname dat may be up in tha form of a regular expression.
.RE
.I file_type
.RS
An optionizzle file type consistin of:
.RS
\fI\-b\fR - Block Device      \fI\-c\fR - Characta Device
.br
\fI\-d\fR - Directory         \fI\-p\fR - Named Pipe
.br
\fI\-l\fR - Symbolic Link     \fI\-s\fR - Socket
.br
\fI\-\-\fR - Ordinary file
.RE
.RE
.I context
.RS
This entry can be either:
.RS
.IP "a." 4
Da securitizzle context dat is ghon be assigned ta tha file (i.e. returned as \fIcontext\fR).
.IP "b." 4
A value of \fB<<none>>\fR can be used ta indicate dat tha matchin filez should not be re-labeled n' causes \fBselabel_lookup\fR(3) ta return \-1 wit \fIerrno\fR set ta \fBENOENT\fR.
.RE
.RE
.RE
.sp
Example:
.RS
# ./contexts/files/file_contexts
.br
# pathname file_type  context
.br
/.*                   system_u:object_r:default_t:s0
.br
/[^/]+        \-\-      system_u:object_r:etc_runtime_t:s0
.br
/tmp/.*               <<none>>
.RE
.sp
.SH "Substitution File Format"
.sp
Each line within tha substitution filez (\fI.subs\fR n' \fI.subs_dist\fR) has tha form:
.RS
.I subs_pathname pathname
.RE
.sp
Where:
.RS
.I pathname
.RS
A path dat matches a entry up in one or mo' of tha file contexts policy configuration file.
.RE
.I subs_pathname
.RS
Da path dat is ghon be aliased (considered equivalent) wit pathname by tha look up process.
.RE
.RE
.sp
Example:
.RS
# ./contexts/files/file_contexts.subs
.br
# pathname  subs_pathname
.br
/myweb      /var/www
.br
/myspool    /var/spool/mail
.sp
Usin tha above example, when \fBselabel_lookup\fR(3) is passed a path of
\fI/myweb/index.html\fR tha function will substitute tha \fI/myweb\fR
component wit \fI/var/www\fR, therefore tha path used is:
.sp
.RS
.I /var/www/index.html
.RE
.RE
.
.SH "NOTES"
.IP "1." 4
If contexts is ta be validated, then tha global option \fBSELABEL_OPT_VALIDATE\fR must be set before callin \fBselabel_open\fR(3). If dis aint set, then it is possible fo' a invalid context ta be returned.
.IP "2." 4
If tha size of file contexts seriez of filez contain nuff entries, then \fBselabel_open\fR(3) may gotz a thugged-out delay as it readz up in tha files, n' if
axed validates tha entries. Put ya muthafuckin choppers up if ya feel dis! If possible use tha \fBSELABEL_OPT_SUBSET\fR option ta reduce tha number of entries processed.
.IP "3." 4
Dependin on tha version of SELinux it is possible dat a \fIfile_contexts.template\fR file may also be present, however dis is now deprecated.
.br
Da template file has tha same ol' dirty format as tha \fIfile_contexts\fR file n' may also contain tha keywordz \fBHOME_ROOT\fR, \fBHOME_DIR\fR, \fBROLE\fR n' \fBUSER\fR. This functionalitizzle has now been moved ta tha policy store n' managed by \fBsemodule\fR(8) n' \fBgenhomedircon\fR(8).
.
.SH "SEE ALSO"
.ad l
.nh
.BR selinux "(8), " selabel_open "(3), " selabel_lookup "(3), " selabel_stats "(3), " selabel_close "(3), " selinux_set_callback "(3), " selinux_file_context_path "(3), " freecon "(3), " selinux_config "(5), " lstat "(2), "selinux_file_context_subs_path "(3), " selinux_file_context_subs_dist_path "(3), " selinux_file_context_homedir_path "(3), "selinux_file_context_local_path "(3), " semodule "(8), " genhomedircon "(8) "
